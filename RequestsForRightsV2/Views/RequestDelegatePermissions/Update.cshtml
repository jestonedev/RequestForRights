@using RequestsForRights.Infrastructure.Security.Interfaces
@using RequestsForRights.Models.Models
@model RequestsForRights.Models.ViewModels.Request.RequestDelegatePermissionsViewModel

@{
    var securityService = (IRequestSecurityService<RequestDelegatePermissionsUserModel>)ViewData["SecurityService"];
    ViewData["IdRequest"] = Model.RequestModel.IdRequest;
    ViewBag.Title = "Изменить заявку на делегирование прав";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var returnUri = Request["returnUri"] ?? Url.Action("Index", "Request");
}

<h2>Изменение заявки # @Model.RequestModel.IdRequest на делегирование прав </h2>

@Html.Partial("ErrorAlert")

<div>
    @Html.Partial("Request/Tabs")
    <div class="tab-content">
        <div role="tabpanel" class="tab-pane fade in active rr-tab-pane" id="rr-request-content">
            @using (Html.BeginForm("Update", "Request", new { id = Model.RequestModel.IdRequest },
                FormMethod.Post, new { @class = "form-horizontal", id = "rr-request-form" }))
            {
                @Html.HttpMethodOverride(HttpVerbs.Put)
                @Html.HiddenFor(r => r.RequestModel.IdRequest)
                @Html.HiddenFor(r => r.RequestModel.IdRequestType)
                @Html.Hidden("returnUri", returnUri)
                <div class="text-center">
                    @Html.ValidationSummary(true)
                </div>

                @Html.Partial("RequestForm")

                <div class="text-center rr-edit-panel">
                    <div class="btn-group" role="group" aria-label="Панель действий">
                        <a href="@returnUri"
                           class="btn btn-default"
                           title="Вернуться к перечню"
                           aria-label="Назад">
                            <span class="glyphicon glyphicon-circle-arrow-left"></span>
                            Назад
                        </a>
                        <button class="btn btn-default rr-save-button">
                            <span class="glyphicon glyphicon-floppy-disk"></span>
                            Сохранить
                        </button>
                        @if (securityService.CanDelete(Model.RequestModel))
                        {
                            <a href="@Url.Action("Delete", "Request",
                                new { id = Model.RequestModel.IdRequest })" id="delete-button"
                               data-success-redirect-to="@Url.Action("Index", "Request")"
                               class="btn btn-danger"
                               title="Вернуться к перечню"
                               aria-label="Удалить">
                                <span class="glyphicon glyphicon-remove"></span>
                                Удалить
                            </a>
                        }
                    </div>
                </div>
            }
        </div>
        @Html.Partial("Request/Agreements")
        @Html.Partial("Request/ExtComments", Model.Comments)
    </div>
</div>

@Html.Partial("DeleteModal", new
{
    Title = "Подтвердите удаление",
    Description = "Вы действительно хотите удалить эту заявку?"
})

@section scripts {
    @Styles.Render("~/Content/bootstrap-datepicker")
    @Scripts.Render("~/bundles/bootstrap-datepicker")
    @Scripts.Render("~/bundles/jquery.autocomplete")
    @Scripts.Render("~/bundles/rr-request.common")
    @Scripts.Render("~/bundles/rr-request.update.insert.common")
    @Scripts.Render("~/bundles/rr-detail.update.common")
    @Scripts.Render("~/bundles/rr-request.comments")
    @Scripts.Render("~/bundles/rr-request.agreements")
    @Scripts.Render("~/bundles/rr-request.delegate-permissions")
}
