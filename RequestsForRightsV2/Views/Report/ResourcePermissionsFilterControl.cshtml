@model IEnumerable<RequestsForRights.Domain.Entities.Resource>

@{
    Layout = null;
    var idResource = (int?)ViewData["IdResource"] ?? -1;
    var date = ViewData["Date"] ?? "";
}

<div class="rr-filter-control">
    @using (Ajax.BeginForm("GetResourcePermissionsDataTable", new AjaxOptions
    {
        UpdateTargetId = "main-table-wrapper",
        InsertionMode = InsertionMode.Replace,
        Url = Url.Action("GetResourcePermissionsDataTable")
    }))
    {
        <div class="form-group col-sm-3 rr-col-sm-no-left-padding">
            @Html.Label("Date", "На дату")
            <div class="input-group date">
                @Html.TextBox("Date", date,
                    new {@class = "form-control"})
                <div class="input-group-addon">
                    <span class="glyphicon glyphicon-th"></span>
                </div>
            </div>
        </div>
        <div class="form-group col-sm-9 rr-col-sm-no-right-padding">
            @Html.Label("IdResource", "Информационный ресурс")

            <select class="form-control" name="IdResource" id="IdResource">
                <option selected>Выберите информационный ресурс</option>
                @foreach (var resourceGroup in Model.GroupBy(r => r.ResourceGroup))
                {
                    <optgroup label="@resourceGroup.Key.Name">
                        @Html.Raw(
                            resourceGroup.Select(r =>
                            {
                                var selected = "";
                                if (r.IdResource == idResource)
                                {
                                    selected = "selected";
                                }
                                return string.Format("<option value=\"{1}\" {2}>{0}</option>",
                                    Html.Encode(r.Name), r.IdResource, selected);
                            }).Aggregate((acc, v) => acc + v));
                    </optgroup>
                }
            </select>
        </div>
        <div class="clearfix"></div>
    }
</div>